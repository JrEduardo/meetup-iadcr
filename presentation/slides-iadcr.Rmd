---
title: Introdução à Análise de Dados de Contagem com R
author: Eduardo E. R. Junior
date: "`r format(Sys.time(), '%d de %B de %Y')`"
fontsize: "10pt"
output: 
  beamer_presentation:
    fig_caption: yes
    highlight: tango
    includes:
      in_header: preambulo-beamer.tex
    keep_tex: no
    slide_level: 3
---

<!-- Arquivos de estilo de bibliográfica e citação "Citation Style -->
<!-- Language (CSL)" disponíveis em -->
<!-- <https://github.com/citation-style-language/styles> -->

```{r, include = FALSE}

##-------------------------------------------
## Definições knitr
library(knitr)

knitr::knit_hooks$set(
    ## Para fontsize de chunk R
    mysize = function(before, options, envir) {
        if (before) return(options$size)
    }
)

opts_chunk$set(
    mysize = TRUE,
    tidy = FALSE,
    cache = TRUE,
    echo = FALSE,
    size = "\\scriptsize",
    out.width = "1\\textwidth",
    fig.path = "figures/",
    cache.path = "cache/",
    fig.align = "center",
    fig.height = 6,
    fig.width = 9,
    dev.args = list(family = "Palatino")
    )

##-------------------------------------------
## Packages
library(lattice)
library(compoisson)

```

<!-- ###  ### -->

\titlepage

### Disponibilização ###

\begin{columns}[c]
\column{.3\textwidth}
\begin{flushright}	
      \includegraphics[scale=0.07]{./figures/github_icon}\\
\end{flushright}
\column{.7\textwidth}
    \url{https://github.com/jreduardo/iadcr}
\end{columns}

\begin{center}
  \vspace{0.3cm}
  {\tt
    \textcolor{url}{I}ntrodução à
    \textcolor{url}{A}nálise de 
    \textcolor{url}{D}ados de 
    \textcolor{url}{C}ontagem com
    \textcolor{url}{R} -
  \href{https://github.com/JrEduardo/iguiR}{iadcr}
  }
\end{center}

### Sumário ###

\tableofcontents[hideallsubsections]

<!-- ------------------------------------------- -->
# Introdução #

###  ###

* Dados de contagem (Definição, objetivos na análise)
* Modelos de regresão (ideia geral)

<!-- ------------------------------------------- -->
# Modelo Poisson #

### Distribuição Poisson ###

\begin{block}{Densidade de probabilidade}
\begin{equation} 
  \Pr(Y = y \mid \lambda) = \frac{\lambda^y}{y! e^\lambda} \quad y \in
  \mathbb{Z}_+
\end{equation}
\end{block}
\pause
\begin{block}{Propriedades}
\begin{itemize}
    \itemsep7.5pt\parskip0pt\parsep0pt
    \item $\frac{P(Y = y - 1)}{P(Y = y)} = \frac{y}{\lambda}$
    \item $E(Y) = \lambda $
    \item $V(Y) = \lambda$
\end{itemize}
\end{block}

###  ###

```{r, fig.cap = "Probabilidades para modelos Poisson"}

## Definindo parametros e calculando as probabilidas
lambdas <- c(3, 8, 15)
x <- 0:30; xx <- rep(x, 3)
px <- NULL
for(i in 1:3) px <- c(px, dpois(x, lambdas[i]))

## Criando categorias para split da lattice
caso <- rep(c("1", "2", "3"), each = length(x))

## Definindo nome para os splits da lattice
fl <- as.expression(lapply(lambdas,
    function(x){ bquote(lambda==.(x)) }))
    
xyplot(px ~ xx | caso, type = c("h", "g"),
       lwd = 3, xlab = "y", ylab = expression(P(Y==y)),
       layout = c(NA, 1), col = 1,
       between = list(x = 0.2, y = 0.3),
       strip = strip.custom(bg = "gray90",
                          factor.levels = fl))

```

### Regressão Poisson ###

\begin{equation*}
    \begin{split}
        Y_i \mid X_i \sim \text{Poisson}(\mu_i = \lambda_i t_i) \\
        g(\lambda_i t_i) = \eta_i =  &X_i\beta \\
    \end{split}
\end{equation*}

Sendo $g$ uma função monótona que,

* Linearize a relação entre $\mu$ e $\eta$; e 
* Confira valores válidos para $\mu$ (pertencente ao espaço paramétrico)

As duas funções de ligação mais comuns são $\log{\mu}$ e $\sqrt{\mu}$

###  ###

\begin{figure}[!ht]
	\includegraphics[scale=1]{./figures/reg-poisson.pdf}
    \caption{Representação esquemática de um modelo de regressão Poisson}
\end{figure}

###  ###

* Propriedades (equidispersão, relação exponencial, razão de
  prob. consecutivas)
* Regressão (familía exponencial, função de ligação, interpretação dos
  parâmetros)
* IWLS, Medidas de diagnóstico
* Exemplo prático

### Estudos de caso ###

\begin{itemize}
    \item
    \href{run:../vignettes/anomalias.html}{\texttt{anomalias.html}} -
    Caso equidisperso
\end{itemize}

# Modelos Alternativos #

## Fuga de equidispersão ##

###  ###

```{r, fig.cap = "Probabilidades para a não verificação de equidispersão"}

## Parametros da distribuição
lambdas <- c(1.36, 8, 915); nus <- c(0.4, 1, 2.5)
medias <- mapply(com.mean, lambda = lambdas, nu = nus)
variancias <- mapply(com.var, lambda = lambdas, nu = nus)

## Calculando as probabilidades
y <- 0:30; yy <- rep(x, 3)
py.com <- py.pois <- NULL
for(i in 1:3) py.com <- c(py.com, dcom(x, lambdas[i], nus[i]))
for(i in 1:3) py.pois <- c(py.pois, dpois(x, medias[i]))

## Criando categorias para split da lattice
caso <- rep(c("1", "2", "3"), each = length(x))
fl <- expression(lambda == 1.36~","~nu == 0.4,
                 lambda == 8~","~nu == 1,
                 lambda == 915~","~nu == 2.5)

xyplot(py.com ~ c(yy - 0.14) | caso, type = c("h", "g"),
       lwd = 2.5, xlab = "y", ylab = expression(P(Y==y)),
       col = "#008080", ylim = c(0, 0.24), xlim = extendrange(y),
       layout = c(NA, 1),
       between = list(x = 0.2,y = 0.3),
       strip = strip.custom(bg = "gray90",
                            factor.levels = fl)) + 
  as.layer(xyplot(py.pois ~ c(yy + 0.14) | caso, 
                  lwd = 2.5, col = 1,
                  type = "h"))

```

### Modelo Binomial Negativo ###

* Modelo Binomial Negativo
    * Definição
    * Vantagens e desvantagens

### Modelos de Quasi-Verossimilhança ###

* Modelo Quasi-Poisson
    * Definição
    * Vantagens e desvantagens

### Estudos de caso ###

\begin{itemize}
    \item \href{run:../vignettes/ninfas.html}{\texttt{ninfas.html}} - Caso
    superdisperso 
    \item \href{run:../vignettes/capulhos.html}{\texttt{capulhos.html}} -
    Caso subdisperso 
\end{itemize}

### Outras abordagens ###


## Excesso de zeros ##

###  ###

* Modelo _Hurdle_ (de barreira)
    * Definição

* Modelo _Zero Inflated Poisson_ (mistura)
    * Definição

* Exemplo Prático

## Outras abordagens ##

###  ###

* Modelo _COM-Poisson_
* Modelo _Gamma-Count_
* Com efeito aleatório
* Modelos para dados censurados
* Modelos para respostas correlacionadas
* ...
